# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения


## Паттерн проектирования
В данной проеткной работе используется паттерн MVP (Model-View-Presenter), который разделяет приложения на 3 основных компонента:
1. Модель. Она служит для представления данных и бизнес-логики приложения. Ее основная задача заключается в выполнении операций, таких как чтение и запись данных, обработка бизнес-логики, а также взаимодействие с базой данных или внешними источниками информации.
2. Представление (View). Оно демонстрирует данные пользователю и обрабатывает его ввод. Представление служит пользовательским интерфейсом, посредством которого осуществляется взаимодействие пользователя с приложением.
3. Презентер (Presenter). Является посредником между моделью и представлением. Он содержит бизнес-логику приложения и управляет взаимодействием между моделью и представлением. Презентер получает данные от модели, форматирует их и передаёт представлению для отображения. Он также обрабатывает пользовательский ввод, передавая соответствующие команды модели для обновления данных.

## Интерфейсы для данных

**Интерфейс представления главной страницы**
interface IPage {
  counter: number; // счетчик у корзины
  catalog: HTMLElement[]; // список карточек на странице
  locked: boolean; // прокрутка страницы
}

**Интерфейс для карточки товара**
interface IProduct {
  id: string;  //  идентификатор товара
  image: string;  // изображение товара
  title: string;  // наименование товара
  category: string;  // категория продукта
  price: number | null;  // цена товара
  description: string;  // описание товара
}

**Интерфейс для корзины**
export interface IBasket {
  basketItems: HTMLElement[]; // массив товаров в корзине
  totalPrice: number; // общая сумма заказа в корзине
}

**Интерфейс для общего заказа**
interface IOrder extends IOrderForm, ICOntactForm {
  total: number; // Общая сумма заказа
  items: string[]; // Список идентификаторов товаров
}

**Интерфейс для формы заказа**
interface IOrderForm {
  payment: string; // способ оплаты
  address: string; // адрес
}

**Интерфейс для формы контактов**
interface IContactForm {
  email: string; // почта
  phone: string; // телефон
}

**Интерфейс для вывода успешной покупки**
interface IOrderResult {
  id: string; // идентификатор товара
  total: number; // общая сумма заказа
}

**Тип данных для ошибок валидации**
type FormErrors = Partial<Record<keyof IOrder, string>>;

## Описание базовых классов

**Класс api** предназначен для упрощения работы с HTTP-запросами к серверу. Он предоставляет методы для выполнения GET- и POST-запросов (включая PUT и DELETE) и обработки ответов от сервера. Класс инкапсулирует базовый URL сервера и настройки запросов, что делает взаимодействие с API более удобным

  handleResponse() - обрабатывает ответ от сервера
  get() - выполняет GET-запрос к серверу
  post() - Выполняет POST-, PUT- или DELETE-запрос к серверу

**Класс Component<T>** - базовый класс для создания компонентов пользовательского интерфейса. Он предоставляет инструменты для работы с DOM-элементами, такие как управление классами, текстовым содержимым, видимостью, блокировкой и изображениями. Класс абстрактный, поэтому используется только через наследование

 toggleClass() - переключает класс у указанного DOM-элемента
 setText() - устанавливает текстовое содержимое указанного DOM-элемента
 setDisabled() - устанавливает статус конпки: активная или нет
 setImage() - устанавливает изображение и альтернативный текст для указанного элемента <img>
 render() - возвращает состояние компонента и возвращает корневой DOM-элемент

**Класс EventEmitter** предназначен для взаимодействия с событиями

 on() - подписывает обработчик на указанное событие
 off() - отписывает обработчик от указанного события
 emit() - инициирует событие с данными
 onAll() - подписывает обработчик на все события
 offAll() - Сбрасывает все обработчики события
 trigger() - создает триггер, который при вызове инициирует указанное событие.
 
**Класс Model** предназначен для того, чтобы можно было отличить модель от простых объектов с данными

  emitChanges() - сообщает всем что модель поменялась

## Слой модель

**Класс ProductApi** отвечает за взаимодействие с сервером. Он наследуется от класса Api и предоставляет методы для получения данных о товарах и отправки данных на сервер
  **поля:**
  readonly cdn: string - предназначен для чтения
  **методы:**
  constructor(cdn: string, baseUrl: string, options?: RequestInit) - конструктор, который принимает параметры
  getProductList() - возвращает массив данных карточек с помощью get-запроса
  order() - отправляет данные на сервер

**Класс Form** отвечает за управление HTML-формами. Он обеспечивает обработку ввода данных, валидацию и отправку формы
  **поля:**
  _submit: HTMLButtonElement — кнопка отправки формы.
  _errors: HTMLElement — элемент для отображения ошибок.
  **методы:**
  constructor(container: HTMLFormElement, events: IEvents) — инициализирует форму, настраивает обработчики событий для ввода данных и отправки формы.
  onInputChange(field: keyof T, value: string) — обрабатывает изменения в полях формы и генерирует события.
  set valid(value: boolean) — управляет состоянием кнопки отправки (активна/неактивна).
  set errors(value: string) — отображает ошибки в форме.
  render(state: Partial<T> & IFormState) — обновляет состояние формы и отображает её.

**Класс Modal** управляет модальными окнами. Он отвечает за открытие, закрытие и отображение содержимого модального окна
  **поля:**
  basket: OrderBasket — объект, хранящий товары в корзине
  totalPrice: number - общая сумма заказа
  **методы:**
  _closeButton: HTMLButtonElement — кнопка закрытия модального окна.
  _content: HTMLElement — контейнер для содержимого модального окна.

**Класс Success** отвечает за отображение сообщения об успешном оформлении заказа
  **поля:**
  _total: HTMLElement — элемент для отображения общей суммы заказа.
  _close: HTMLButtonElement — кнопка закрытия сообщения.
  **методы:**
  constructor(container: HTMLElement, actions?: ISuccessActions) — инициализирует сообщение об успехе и настраивает обработчики событий.
  set total(value: string) — устанавливает текст с общей суммой заказа.

**Класс AppState** управляет состоянием приложения. Он хранит данные о каталоге товаров, корзине, заказе и ошибках формы
  **поля:**
  catalog: IProduct[] — список товаров в каталоге.
  basket: IProduct[] — список товаров в корзине.
  order: IOrder — данные о текущем заказе.
  preview: string | null — идентификатор товара, который просматривается в данный момент.
  formErrors: FormErrors — ошибки валидации формы.
  counter: number — количество товаров в корзине.
  **методы:**
  setCatalog(items: IProduct[]) — обновляет каталог товаров.
  setPreview(item: IProduct) — устанавливает товар для предпросмотра.
  addProduct(value: IProduct) — добавляет товар в корзину.
  removeProduct(product: IProduct) — удаляет товар из корзины.
  clearBasket() — очищает корзину.
  getTotal() — возвращает общую сумму заказа.
  setOrderField(field: keyof IOrderForm, value: string) — устанавливает значение поля заказа.
  setContactsField(field: keyof IContactForm, value: string) — устанавливает значение поля контактов.
  validateOrder() — валидирует данные заказа.
  validateContacts() — валидирует контактные данные.
  clearForm() — очищает данные формы.

## Слой представления

**Класс Card** отвечает за отображение карточки товара. Он управляет отображением категории, названия, изображения, цены и кнопки добавления в корзину
  **поля:**
  _category: HTMLElement — элемент для отображения категории товара.
  _title: HTMLElement — элемент для отображения названия товара.
  _image: HTMLImageElement — элемент для отображения изображения товара.
  _price: HTMLElement — элемент для отображения цены товара.
  _button: HTMLButtonElement — кнопка добавления товара в корзину.
  **методы:**
  constructor(container: HTMLElement, actions?: ICardActions) — инициализирует карточку товара и настраивает обработчики событий.
  set id(value: string) — устанавливает идентификатор товара.
  get id(): string — возвращает идентификатор товара.
  set category(value: string) — устанавливает категорию товара.
  get category(): string — возвращает категорию товара.
  set title(value: string) — устанавливает название товара.
  get title(): string — возвращает название товара.
  set image(value: string) — устанавливает изображение товара.
  set price(value: number) — устанавливает цену товара.
  setButtonState(added: boolean) — управляет состоянием кнопки добавления в корзину.

**Класс ProductDetail** расширяет функциональность класса Card для отображения подробной информации о товаре
class MainPageView
  **поля:**
  _description: HTMLElement — элемент для отображения описания товара.
  **методы:**
  constructor(container: HTMLElement, actions?: ICardActions) — инициализирует карточку товара с подробной информацией.
  set description(value: string) — устанавливает описание товара.

**Класс Order** управляет формой заказа. Он отвечает за выбор способа оплаты и ввод адреса доставки
  **поля:**
  _cardPaymentButton: HTMLButtonElement — кнопка выбора оплаты картой.
  _cashPaymentButton: HTMLButtonElement — кнопка выбора оплаты при получении.
  **методы:**
  constructor(container: HTMLFormElement, events: IEvents) — инициализирует форму заказа и настраивает обработчики событий.
  set payment(name: string) — устанавливает выбранный способ оплаты.
  set address(value: string) — устанавливает адрес доставки.

**Класс Contacts** управляет формой контактных данных. Он отвечает за ввод email и телефона
  **методы:**
  constructor(container: HTMLFormElement, events: IEvents) — инициализирует форму контактных данных.
  set phone(value: string) — устанавливает номер телефона.
  set email(value: string) — устанавливает email.

**Класс Page** управляет основным интерфейсом страницы. Он отвечает за отображение каталога товаров, счетчика корзины и блокировку страницы при открытии модальных окон
  **поля:**
  _counter: HTMLElement — элемент для отображения количества товаров в корзине.
  _catalog: HTMLElement — контейнер для отображения каталога товаров.
  _wrapper: HTMLElement — контейнер для блокировки страницы.
  _basket: HTMLElement — кнопка открытия корзины.
  **методы:**
  constructor(container: HTMLElement, events: IEvents) — инициализирует страницу и настраивает обработчики событий.
  set counter(value: number) — обновляет счетчик товаров в корзине.
  set catalog(items: HTMLElement[]) — обновляет каталог товаров.
  set locked(value: boolean) — блокирует или разблокирует страницу.

## Слой презентера
**Используется событийно-ориентированный подход. Каждое действие пользователя инициирует событие, которое обрабатывается презентером. Презентер взаимодействует с моделью для обновления данных и с представлением для отображения изменений. Этот класс не будет вынесен в отдельный файл, а останется в основном скрипте приложения**

## Взаимодействие компонентов
items:changed - изменение товара
card:select — выбор товара
preview:changed — изменение предпросмотра товара
card:toBasket — добавление товара в корзину
basket:changed — изменение состояния корзины
basket:open — открытие корзины
basket:remove — удаление товара из корзины
order:open — открытие формы заказа
order:submit — отправка формы заказа
contacts:submit — отправка формы контактных данных
modal:open - открытие модального окна
modal:close — закрытие модального окна
orderFormErrors:change - ошибки валидации заказа
contactsFormErrors:change - ошибки валидации контактов